---
layout: post
title: "비동기 파이썬"
tags:
  - python
---

파이썬 3.4 부터 사용이 가능한 비동기 파이썬의 핵심인 [`asyncio`](https://docs.python.org/3.7/library/asyncio.html) 모듈에 대해서 공부를 제대로 한 적이 없는데, 해당 모듈에 대해서도 한번 정리라도 해보면 좋을 것 같다는 생각이 들어 정리를 해보게 되었다.

## `asyncio`

`asyncio`는 기본적으로 `async`, `await` 키워드와 함께 비동기 코드를 작성하기 위한 라이브러리이다. IO를 자주 사용하거나, 고수준의 네트워크 관련 코드를 작성할 때 좋다고 한다. 모듈 소개 페이지에 아래와 같은 코드로 "Hello World!"를 작성해놓았다.

```python
import asyncio

async def main():
    print('Hello ...')
    await asyncio.sleep(1)
    print('... World!')

# Python 3.7+
asyncio.run(main())
```

## `asyncio`를 이해하기 위해

python `coroutine`들을 동시에 실행할 수 있고, 큐를 통해 태스크를 배분할 수 있고, 네트워크 IO나, IPC등을 처리할 수 있고, subprocess를 처리하거나 lock 또한 처리 가능하다고 한다. 이런 식으로 보면 만능 라이브러리로 보이지만, 역시나 사용하기 위해서는 기본적인 개념을 이해해야한다.

### `coroutine`

`asyncio`를 사용하면서 나오는 가장 기본적인 개념이다. `async`, `await`로 선언이 가능하며, 또 그 방법을 선호한다고 문서에 설명되어 있다. 위에서 보았던 "Hello World!" 코드의 `main` 함수가 `coroutine`을 생성하는 함수이다. Python shell에서 실행해보면 아래와 같은 결과가 나온다.

```python
>>> import asyncio
>>> async def main():
...     print("Hello...")
...     await asyncio.sleep(1)
...     print("... World!")
...
>>> asyncio.run(main())
Hello...
... World!
```

하지만 `main`만 호출한다면 조금은 다른 결과가 나온다.

```python
>>> main()
<coroutine object main at 0x101589dc8>
```

원하는 실행은 안되고, `coroutine` 객체만 반환되었다. 해당 객체는 `coroutine`안에서 `await`를 통해 실행시키거나, `asyncio.run()`을 통해 실행해야 한다.
